<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <script src='https://cdn.plot.ly/plotly-2.14.0.min.js'></script>
        <title>Wagner-Sargento weather station</title>
    </head>
    <script>
        var temperature_trace = {
            x: [],
            y: [],
            mode: 'lines+markers',
            name: 'Temperature' // Add a name for the temperature trace
        };

        var humidity_trace = {
            x: [],
            y: [],
            mode: 'lines+markers',
            name: 'Humidity' // Add a name for the humidity trace
        };

        function getTemps() {
            temperature_trace.x = [];
            temperature_trace.y = [];
            humidity_trace.x = []; // Reset humidity x data
            humidity_trace.y = []; // Reset humidity y data
            fetch('sensor_data.csv')
                .then(response => response.text())
                .then(text => {
                    let data = text.split("\n");
                    for (let i = 1; i < data.length - 1; i += 1) {
                        csvData = data[i].split(",");
                        temperature_trace.y.push(csvData[2]);
                        temperature_trace.x.push(i);
                        humidity_trace.y.push(csvData[1]);
                        humidity_trace.x.push(i);
                    }
                    document.getElementById("dataLabel").innerHTML = csvData[0] + "Â°C"; // Display last temperature data point

                    // Create separate traces for temperature and humidity
                    var plotData = [temperature_trace, humidity_trace];
                    var layout = {
                        title: 'Temperature and Humidity Data', // Update the title
                        xaxis: {
                            title: 'Num Points'
                        },
                        yaxis: {
                            title: 'Degrees Celsius and % Humidity' // Update the y-axis title
                        }
                    };
                    Plotly.newPlot('dataGraph', plotData, layout); // Plot both temperature and humidity data
                });
        }
    </script>
    <body onload="getTemps()">
        <div>
            <h1>Wagner-Sargento weather station</h1>
            <h2 id="dataLabel">?</h2>
            <div id="dataGraph"></div>
        </div>
    </body>
</html>
